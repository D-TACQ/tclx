#
# Makefile  --
#
# Makefile for Extended Tcl C sources.  This will compile all of Extended Tcl
# and add it to the libtcl.a in the parent directory.  Generates a Tcl shell
# in the parent directory.
# 
#------------------------------------------------------------------------------
# Copyright 1992-1993 Karl Lehenbauer and Mark Diekhans.
#
# Permission to use, copy, modify, and distribute this software and its
# documentation for any purpose and without fee is hereby granted, provided
# that the above copyright notice appear in all copies.  Karl Lehenbauer and
# Mark Diekhans make no representations about the suitability of this
# software for any purpose.  It is provided "as is" without express or
# implied warranty.
#------------------------------------------------------------------------------
# $Id: Makefile,v 2.10 1993/07/18 22:38:14 markd Exp markd $
#------------------------------------------------------------------------------
#

include ../Config.mk
include ../config/${TCL_CONFIG_FILE}
SHELL=/bin/sh

#------------------------------------------------------------------------------

LIBTCLX.A = ../tclmaster/lib/libtclx.a
TCL       = ../tclmaster/bin/tcl

CFLAGS= ${OPTIMIZE_FLAG} ${XCFLAGS} -I../${TCL_UCB_DIR} ${MEM_DEBUG_FLAGS} \
        ${SYS_DEP_FLAGS}
LDLIBS= ${LIBTCLX.A} ${LIBS}

#------------------------------------------------------------------------------

OBJS= \
    tclXbsearch.o    tclXchmod.o      tclXclock.o      tclXcmdloop.o \
    tclXcnvclock.o   tclXcreate.o     tclXdebug.o      tclXdup.o     \
    tclXfcntl.o      tclXfilecmds.o   tclXfilescan.o   tclXflock.o   \
    tclXfstat.o      tclXgeneral.o    tclXgetdate.o    tclXhandles.o \
    tclXid.o         tclXkeylist.o    tclXlib.o        tclXlist.o    \
    tclXmath.o       tclXmsgcat.o     tclXprocess.o    tclXprofile.o \
    tclXregexp.o     tclXselect.o     tclXserver.o     tclXsignal.o  \
    tclXstartup.o    tclXstring.o     tclXunixcmds.o   tclXutil.o
 
#------------------------------------------------------------------------------

all: made.tmp ${TCL}

${TCL}: main.o ${LIBTCLX.A} made.tmp 
	${CC} ${CFLAGS} ${XLDFLAGS} main.o ${LDLIBS} -o ${TCL}
	if ${DO_STRIPPING} ; then \
	    strip ${TCL}; \
	    ${MCS_CMD} ${TCL}; fi

made.tmp: ${OBJS} ${CPLUSOBJS}
	${AR} cr ${LIBTCLX.A} ${OBJS} ${CPLUSOBJS}
	${RANLIB_CMD} ${LIBTCLX.A}
	touch made.tmp

tclXstartup.o: patchlevel.h tclXstartup.c
	${CC} -c ${CFLAGS} -DTCL_MASTERDIR=\"${TCL_MASTERDIR}\" tclXstartup.c

main.o: patchlevel.h main.c

tclXgetdate.c: tclXgetdate.y
	${YACC} tclXgetdate.y
	mv y.tab.c tclXgetdate.c

tcl++.o: tcl++.C tcl++.h
	${CCPLUS} -c ${CFLAGS} tcl++.C

#------------------------------------------------------------------------------
# This is just to test if it compiles.

tcl++: main++.o made.tmp
	${CCPLUS} ${CFLAGS} main++.o ${LDLIBS} ${LIBS} ${XLDFLAGS} \
	   -o ../tcl++

main++.o: tcl++.h main++.C
	${CCPLUS} -c -I${CPLUSINCL} ${CFLAGS} main++.C


#------------------------------------------------------------------------------

clean:
	-rm -f made.tmp tclXgetdate.c
	-rm -f *.o ${TCL} tcl++

