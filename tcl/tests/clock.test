#
# clock.test
#
# Tests for the getclock, fmtclock and convertclock commands.
#---------------------------------------------------------------------------
# Copyright 1992 Karl Lehenbauer and Mark Diekhans.
#
# Permission to use, copy, modify, and distribute this software and its
# documentation for any purpose and without fee is hereby granted, provided
# that the above copyright notice appear in all copies.  Karl Lehenbauer and
# Mark Diekhans make no representations about the suitability of this
# software for any purpose.  It is provided "as is" without express or
# implied warranty.
#------------------------------------------------------------------------------
# $Id: clock.test,v 2.3 1993/01/26 03:45:12 markd Exp markd $
#------------------------------------------------------------------------------
#

if {[info procs test] != "test"} then {source testlib.tcl}

# Try  getclock, hard to test the result.

test clock-1.1 {getclock tests} {
    list [catch {set clockval [getclock];expr $clockval+1} msg]
} {0}
test clock-1.2 {getclock tests} {
    list [catch {getclock 1990} msg] $msg
} {1 {wrong # args: getclock}}

# Test fmtclock

test clock-2.1 {fmtclock tests} {
    set clockval 657687766
    fmtclock $clockval {%a %b %d %I:%M:%S %p %Y} GMT
} {Sun Nov 04 03:02:46 AM 1990}

test clock-2.2 {fmtclock tests} {
    list [catch {fmtclock} msg] $msg
} {1 {wrong # args: fmtclock clockval [format] [GMT|{}]}}


# Test convertclock

test clock-3.1 {convertclock tests} {
    list [catch convertclock msg] $msg
} {1 {wrong # args: convertclock dateString [GMT|{}] [baseclock]}}

test clock-3.2 {convertclock tests} {
    fmtclock [convertclock "14 Feb 92" GMT] {%m/%d/%y %I:%M:%S %p} GMT
} {02/14/92 12:00:00 AM}

test clock-3.3 {convertclock tests} {
    fmtclock [convertclock "Feb 14, 1992 12:20 PM" GMT] {%m/%d/%y %I:%M:%S %p} GMT
} {02/14/92 12:20:00 PM}

test clock-3.5 {convertclock tests} {
    fmtclock [convertclock "Feb 14, 1992 12:20 PM" {GMT} 319363200] {%m/%d/%y %I:%M:%S %p} GMT
} {02/14/92 12:20:00 PM}

test clock-3.6 {convertclock tests} {
    set clock [convertclock "Oct 23,1992 15:00"]
    fmtclock $clock {%b %d,%Y %H.%M}
} {Oct 23,1992 15.00}

test clock-3.7 {convertclock tests} {
    set clock [convertclock "Oct 23,1992 15:00 GMT"]
    fmtclock $clock {%b %d,%Y %H.%M GMT} GMT
} {Oct 23,1992 15.00 GMT}


test clock-3.7 {convertclock tests} {
    # Test if local timezone works when not explicitly specified.

    set clock [getclock]
    set ourzone [fmtclock $clock %Z]
    set intime [fmtclock $clock {%a %h %d %T %Y}]

    set cnv1 [convertclock $intime]
    set cnv2 [convertclock "$intime $ourzone"]
    expr {$cnv1 == $cnv2}
} 1

set fmt {%m/%d/%y %I:%M:%S %p}
foreach hour {01 02 03 04 05 06 07 08 09 10 11 12} {
   foreach min {00 01 59} {
       foreach med {AM PM} {
           test clock-3.8 {convertclock tests} {
                fmtclock [convertclock "1/1/72 $hour:$min:00 $med"] $fmt
           } "01/01/72 $hour:$min:00 $med"

           test clock-3.9 {convertclock tests} {
                fmtclock [convertclock "1/1/72 $hour:$min:00 $med" GMT] $fmt GMT
           } "01/01/72 $hour:$min:00 $med"
       }
   }
}
