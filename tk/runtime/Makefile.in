#
# Makefile --
#
# Makefile for building Tcl sources used by wishx.
#------------------------------------------------------------------------------
# Copyright 1992-1993 Karl Lehenbauer and Mark Diekhans.
#
# Permission to use, copy, modify, and distribute this software and its
# documentation for any purpose and without fee is hereby granted, provided
# that the above copyright notice appear in all copies.  Karl Lehenbauer and
# Mark Diekhans make no representations about the suitability of this
# software for any purpose.  It is provided "as is" without express or
# implied warranty.
#------------------------------------------------------------------------------
# $Id: Makefile.in,v 1.8 1993/07/31 04:43:45 markd Exp markd $
#------------------------------------------------------------------------------
#
SHELL=/bin/sh

#------------------------------------------------------------------------------
# Autoconfig defines that can be overridden in Config.mk

srcdir = @srcdir@
VPATH  = @srcdir@

MAN_DIR_SEPARATOR=@MAN_DIR_SEPARATOR@

#------------------------------------------------------------------------------
# Include user-editable defines.

@MAKEINCLUDE@ @MAKEQUOTE@$(srcdir)/../Config.mk@MAKEQUOTE@

#------------------------------------------------------------------------------

TK.TCL      = ../tkmaster/tk.tcl
TK.TLIB     = ../tkmaster/tk.tlib
TK.TNDX     = ../tkmaster/tk.tndx
PROLOG.PS   = ../tkmaster/prolog.ps
TCLHELP     = ../tkmaster/bin/tclhelp
DEMOS       = ../tkmaster/demos
MAN         = ../tkmaster/man
HELP        = ../tkmaster/help
CPMANPAGES  = $(srcdir)/../tools/cpmanpages.tcl
BLDMANHELP  = $(srcdir)/../tools/bldmanhelp.tcl
TKMANPAGES  = $(srcdir)/../tools/tkmanpages

#------------------------------------------------------------------------------
# Copy all files.  Note, tk.tcl must be edited to not nuke the auto_path.
#

all: ${TK.TCL} ${TK.TLIB} ${TK.TNDX} ${PROLOG.PS} ${TCLHELP} ${DEMOS} ${MAN}


${TK.TCL}: ../${TK_UCB_SRC}/library/tk.tcl
	rm -f ${TK.TCL}
	fgrep -v "set auto_path" ../${TK_UCB_SRC}/library/tk.tcl > ${TK.TCL}

${TK.TLIB} ${TK.TNDX}: ../${TK_UCB_SRC}/library/tclIndex tkdemo.tcl
	../runtcl "-c convert_lib ../${TK_UCB_SRC}/library/tclIndex ${TK.TLIB}"
	cat tkdemo.tcl >>${TK.TLIB}
	../runtcl "-c buildpackageindex ${TK.TLIB}"
	
${PROLOG.PS}: ../${TK_UCB_SRC}/library/prolog.ps
	cp ../${TK_UCB_SRC}/library/prolog.ps ${PROLOG.PS}

${TCLHELP}: tclhelp.tcl
	echo "#!${TCL_BINDIR}/wishx -f" >  ${TCLHELP}
	cat tclhelp.tcl                 >> ${TCLHELP}
	chmod +rx ${TCLHELP}

${DEMOS}:
	mkdir ${DEMOS}
	(cd ../${TK_UCB_SRC}/library/demos;tar -cf - .) | \
	    (cd ${DEMOS}; tar -xf -)

${MAN}:
	../runtcl ${CPMANPAGES} TK ../${TK_UCB_SRC}/doc \
                  ${MAN_DIR_SEPARATOR}

#------------------------------------------------------------------------------
# Build help for Tk.

buildtkhelp:
	rm -rf ${HELP}
	mkdir ${HELP}
	../runtcl ${BLDMANHELP} ../${TK_UCB_SRC}/doc ${TKMANPAGES} \
                  ${HELP} Tk.brf

#------------------------------------------------------------------------------

clean:
	rm -f ${TK.TCL} ${TK.TLIB} ${TK.TNDX} ${PROLOG.PS}
	rm -rf ${DEMOS} ${MAN}

#------------------------------------------------------------------------------
# Restore to the distributed state.

distclean: clean
	rm -f Makefile
