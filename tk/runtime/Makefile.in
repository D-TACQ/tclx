#
# Makefile --
#
# Makefile for building Tcl sources used by wishx.
#------------------------------------------------------------------------------
# Copyright 1992-1993 Karl Lehenbauer and Mark Diekhans.
#
# Permission to use, copy, modify, and distribute this software and its
# documentation for any purpose and without fee is hereby granted, provided
# that the above copyright notice appear in all copies.  Karl Lehenbauer and
# Mark Diekhans make no representations about the suitability of this
# software for any purpose.  It is provided "as is" without express or
# implied warranty.
#------------------------------------------------------------------------------
# $Id: Makefile.in,v 1.14 1993/10/01 03:49:16 markd Exp markd $
#------------------------------------------------------------------------------
#
SHELL=/bin/sh

#------------------------------------------------------------------------------
# Autoconfig defines that can be overridden in Config.mk

srcdir            = @srcdir@
srcbasedir        = @srcbasedir@
bldbasedir        = @bldbasedir@
VPATH             = @srcdir@
prefix            = @prefix@
execprefix        = @execprefix@

#------------------------------------------------------------------------------
# Include user-editable defines.

@MAKEINCLUDE@ @MAKEQUOTE@${bldbasedir}/Config.mk@MAKEQUOTE@

#------------------------------------------------------------------------------

TK.TCL      = ${bldbasedir}/tkmaster/tk.tcl
TK.TLIB     = ${bldbasedir}/tkmaster/tk.tlib
TK.TNDX     = ${bldbasedir}/tkmaster/tk.tndx
PROLOG.PS   = ${bldbasedir}/tkmaster/prolog.ps
TCLHELP     = ${bldbasedir}/tkmaster/bin/tclhelp
DEMOS       = ${bldbasedir}/tkmaster/demos
HELP        = ${bldbasedir}/tkmaster/help
TKMANPAGES  = ${srcbasedir}/tools/tkmanpages
BLDMANHELP  = ../runtcl ${srcbasedir}/tools/bldmanhelp

#------------------------------------------------------------------------------
# Copy all files.
#

all: ${TK.TCL} ${TK.TLIB} ${TK.TNDX} ${PROLOG.PS} ${TCLHELP} ${DEMOS} HELPCP

${TK.TCL}: ${TK_UCB_SRC}/library/tk.tcl
	rm -f ${TK.TCL}
	cp ${TK_UCB_SRC}/library/tk.tcl ${TK.TCL}

${TK.TLIB} ${TK.TNDX}: ${TK_UCB_SRC}/library/tclIndex tkdemo.tcl
	../runtcl "-c convert_lib ${TK_UCB_SRC}/library/tclIndex ${TK.TLIB}"
	cat ${srcdir}/tkdemo.tcl >>${TK.TLIB}
	../runtcl "-c buildpackageindex ${TK.TLIB}"
	
${PROLOG.PS}: ${TK_UCB_SRC}/library/prolog.ps
	cp ${TK_UCB_SRC}/library/prolog.ps ${PROLOG.PS}

${TCLHELP}: tclhelp.tcl
	echo "#!${TCL_BINDIR}/wishx -f" >  ${TCLHELP}
	cat ${srcdir}/tclhelp.tcl       >> ${TCLHELP}
	chmod +rx ${TCLHELP}

${DEMOS}:
	mkdir ${DEMOS}
	(cd ${TK_UCB_SRC}/library/demos;tar -cf - .) | \
	    (cd ${DEMOS}; tar -xf -)

#------------------------------------------------------------------------------
# Copy help files if they don't appear to exist and we are in a different
# directory from the srcdir.
#

HELPCP: ${HELP}/Tk.brf

${HELP}/Tk.brf:
	${srcbasedir}/tools/cphelpdir` ${srcbasedir}/tkmaster/help \
           ${bldbasedir}/tkmaster/help

#------------------------------------------------------------------------------
# Build help for Tk.

buildtkhelp:
	rm -rf ${HELP}
	mkdir ${HELP}
	${BLDMANHELP} ${TK_UCB_SRC}/doc ${TKMANPAGES} ${HELP} Tk.brf

#------------------------------------------------------------------------------
# Clean up everything but the manual pages that we copied to the master
# directories and the demos.

partclean:
	rm -f ${TK.TCL} ${TK.TLIB} ${TK.TNDX}

#------------------------------------------------------------------------------
# Clean up all files that were built by make.

clean: partclean
	rm -rf ${PROLOG.PS} ${DEMOS} ${MAN}

#------------------------------------------------------------------------------
# Restore to the distributed state.

distclean: clean
	rm -f Makefile
